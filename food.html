<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Food Inventory</title>
  <style>
    body {
      background-color: #3B1F0E;
      color: #FFD700;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h2 {
      margin-bottom: 10px;
    }

    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      width: 100%;
      max-width: 800px;
      align-items: center;
    }

    #notes {
      flex: 1;
      padding: 6px 10px;
      font-size: 1em;
      border: 2px solid #FFD700;
      background-color: #5A3320;
      color: #FFD700;
      border-radius: 4px;
    }

    button {
      width: 30px;
      height: 30px;
      font-size: 1em;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button#reset-all {
      background-color: #228B22;
    }

    button#reset-text {
      background-color: #B22222;
    }

    .grid {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      max-width: 800px;
      overflow-y: auto;
    }

    .row {
      display: flex;
      justify-content: space-between;
      gap: 20px;
    }

    .cell {
      display: flex;
      align-items: center;
      gap: 6px;
      min-width: 150px;
      flex: 1;
    }

    .box {
      width: 20px;
      height: 20px;
      border: 2px solid #FFD700;
      cursor: pointer;
      border-radius: 4px;
      flex-shrink: 0;
    }

    .red {
      background-color: #B22222;
    }

    .blue {
  background-color: #1E90FF; /* dodger blue */
}


    .green {
      background-color: #228B22;
    }

    .yellow {
      background-color: #CCCC00;
    }

    .blank {
      background-color: transparent;
      border: 2px solid #FFD700;
    }

    a {
      text-decoration: none
    }
  </style>
</head>

<body>

  <h2><a href="/index.html">food</a></h2>
  <div class="controls">
    <button id="reset-all"></button>
    <input type="text" id="notes" placeholder="Write something..." />
    <button id="reset-text"></button>
  </div>

  <div class="grid" id="food-grid"></div>


  <script type="module">
    // Firebase v12.3.0 SDK imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    // âœ… Use your new Firebase project
    const firebaseConfig = {
      apiKey: "AIzaSyDcGxGdGqCdpqpSp3lL9_UHaoRKQ2PrXSQ",
      authDomain: "food-c45ed.firebaseapp.com",
      projectId: "food-c45ed",
      storageBucket: "food-c45ed.firebasestorage.app",
      messagingSenderId: "1048735903914",
      appId: "1:1048735903914:web:257dcd44741ff6cd90a0d3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // === App Data ===
    const FOOD_LIST = [
      ["Kale", "flax"],
      ["Oranges", "Margarine"],
      ["Craisins", "lemon"],
      ["big nuts", "lime"],
      ["Soy", "Bread"],
      ["bananas", "Bagels"],
      ["kale", "Potatoes"],
      ["Berries", "Popcorn"],
      ["Fried", "Sweet"],

      // $ items at the bottom
      ["Barley$", "Qunioa$"],
      ["corn$", "lentils$"]
    ];

    const STATES = ["green", "red"];
    const BLUE_STATES = ["blank", "blue"]; // special cycle for $ inner boxes

    const grid = document.getElementById("food-grid");
    const notes = document.getElementById("notes");
    const resetAllBtn = document.getElementById("reset-all");
    const resetTextBtn = document.getElementById("reset-text");

    // === Helpers ===
    function createBox(key, states, defaultState) {
      const box = document.createElement("div");
      box.className = "box " + key;
      box.classList.add(defaultState);
      box.onclick = () => {
        const current = states.findIndex(s => box.classList.contains(s));
        const next = (current + 1) % states.length;
        box.classList.remove(...states);
        box.classList.add(states[next]);
        saveState(key, states[next]);
      };
      return box;
    }

    function createCell(name, isLeft) {
      const isDollar = name.includes("$");
      const clean = name.replace("$", "").trim();
      const outerKey = "outer_" + clean.toLowerCase();
      const innerKey = "inner_" + clean.toLowerCase();

      const cell = document.createElement("div");
      cell.className = "cell";

      if (isDollar && isLeft) {
        cell.appendChild(createBox(outerKey, STATES, "green"));
        cell.appendChild(createBox(innerKey, BLUE_STATES, "blank"));
        cell.appendChild(document.createTextNode(clean));
      } else if (isDollar && !isLeft) {
        cell.appendChild(document.createTextNode(clean));
        cell.appendChild(createBox(innerKey, BLUE_STATES, "blank"));
        cell.appendChild(createBox(outerKey, STATES, "green"));
      } else {
        if (isLeft) cell.appendChild(createBox(outerKey, STATES, "green"));
        cell.appendChild(document.createTextNode(clean));
        if (!isLeft) cell.appendChild(createBox(outerKey, STATES, "green"));
      }
      return cell;
    }

    function buildGrid() {
      FOOD_LIST.forEach(pair => {
        const row = document.createElement("div");
        row.className = "row";
        row.appendChild(createCell(pair[0], true));
        row.appendChild(createCell(pair[1], false));
        grid.appendChild(row);
      });
    }

    function collectBoxStates() {
      const boxes = {};
      document.querySelectorAll(".box").forEach(box => {
        const key = Array.from(box.classList).find(c =>
          c.startsWith("outer_") || c.startsWith("inner_")
        );
        if (key) {
          const state = Array.from(box.classList).find(c =>
            [...STATES, ...BLUE_STATES].includes(c)
          );
          boxes[key] = state;
        }
      });
      return boxes;
    }

    // === Firestore Helpers ===
    async function loadData(docId) {
      try {
        const docRef = doc(db, "food_inventory", docId);
        const snap = await getDoc(docRef);
        if (snap.exists()) {
          console.log("ðŸ“¥ Loaded from Firestore:", snap.data());
          return snap.data();
        }
        return {};
      } catch (err) {
        console.error("âŒ loadData failed:", err);
        return {};
      }
    }

    async function saveData(docId, data) {
      try {
        const docRef = doc(db, "food_inventory", docId);
        await setDoc(docRef, data, { merge: true });
        console.log("âœ… Saved to Firestore:", data);
      } catch (err) {
        console.error("âŒ saveData failed:", err);
      }
    }

    async function saveState(key, value) {
      const currentData = await loadData("food");
      const boxes = currentData.boxes || {};
      boxes[key] = value;
      await saveData("food", { boxes, notes_value: notes.value });
    }

    // === Reset buttons ===
    resetTextBtn.onclick = () => {
      notes.value = "";
      saveData("food", { boxes: collectBoxStates(), notes_value: "" });
    };

    resetAllBtn.onclick = () => {
      const newBoxes = {};
      FOOD_LIST.forEach(pair => {
        pair.forEach(name => {
          const clean = name.replace("$", "").trim().toLowerCase();
          if (name.includes("$")) {
            newBoxes["outer_" + clean] = "green";
            newBoxes["inner_" + clean] = "blank";
          } else {
            newBoxes["outer_" + clean] = "green";
          }
        });
      });
      saveData("food", { boxes: newBoxes, notes_value: "" });

      notes.value = "";
      document.querySelectorAll(".box").forEach(box => {
        box.classList.remove("red", "green", "blue", "blank");
        if (box.classList.contains("inner_")) {
          box.classList.add("blank");
        } else {
          box.classList.add("green");
        }
      });
    };

    // === Init ===
    buildGrid(); // build first

    loadData("food").then(data => {
      notes.value = data.notes_value || "";
      const boxesData = data.boxes || {};
      Object.keys(boxesData).forEach(key => {
        const box = document.querySelector(`.box.${key}`);
        if (box) {
          box.classList.remove(...STATES, ...BLUE_STATES);
          box.classList.add(boxesData[key]);
        }
      });
    });

    notes.addEventListener("input", () => {
      saveData("food", { boxes: collectBoxStates(), notes_value: notes.value });
    });
  </script>

</body>

</html>